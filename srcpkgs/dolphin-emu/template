# Template file for 'dolphin-emu'
pkgname=dolphin-emu
version=5.0.19870
revision=1
_dolphin_commit=032c77b462a220016f23c5079e71bb23e0ad2adf
_mgba_commit=f637b5b1e8f9759495463677532309e307baf157
_googletest_commit=7e33b6a1c497ced1e98fc60175aeb4678419281c
_zlib_ng_commit=73bbb54cf6686a81710a1326c4cf1cfee9a49784
_cubeb_commit=ac8474a5929e9de3bce84f16f8c589240eb9f7c4
_sanitizers_cmake_commit=c3dc841af4dbf44669e65b82cb68a575864326bd
_implot_commit=85573fe04ad27f912074a2e7cde889fdf912b0c6
_libspng_commit=e5c1fc470fceaca08b8c30dc40768c28b82b9e12
_rcheevos_commit=111db1cabe6a3723155cbe8726874b4b3abbbb6c
_vma_commit=f428606392ffbe0a9b7a6673a7c1ed97d4ff9a62
_spirv_cross_commit=bccaa94db814af33d8ef05c153e7c34d8bd4d685
#Version/hash pair can be found at https://dolphin-emu.org/download/
archs="x86_64* aarch64* ppc64le*"
create_wrksrc=yes
build_style=cmake
configure_args="-DUSE_SHARED_ENET=ON
 -DDOLPHIN_WC_DESCRIBE=${version%.*}-${version##*.}
 -DDOLPHIN_WC_REVISION=$_dolphin_commit
 -DDOLPHIN_WC_BRANCH=master"
hostmakedepends="pkg-config qt6-tools qt6-base gettext-devel"
makedepends="
 zlib-devel glew-devel libusb-devel qt6-base-devel qt6-svg-devel miniupnpc-devel
 libevdev-devel SDL2-devel pulseaudio-devel alsa-lib-devel ffmpeg-devel libgomp-devel
 libcurl-devel portaudio-devel libopenal-devel soundtouch-devel lzo-devel
 libbluetooth-devel mbedtls-devel SFML-devel libenet-devel liblzma-devel pugixml-devel"
depends="desktop-file-utils"
short_desc="Gamecube / Wii / Triforce emulator"
maintainer="Henry Naguski <henry@nilsu.org>"
license="GPL-2.0-or-later"
homepage="http://dolphin-emu.org"
distfiles="https://github.com/dolphin-emu/dolphin/archive/${_dolphin_commit}.tar.gz
 https://github.com/mgba-emu/mgba/archive/${_mgba_commit}.tar.gz
 https://github.com/google/googletest/archive/${_googletest_commit}.tar.gz
 https://github.com/zlib-ng/zlib-ng/archive/${_zlib_ng_commit}.tar.gz
 https://github.com/mozilla/cubeb/archive/${_cubeb_commit}.tar.gz
 https://github.com/arsenm/sanitizers-cmake/archive/${_sanitizers_cmake_commit}.tar.gz
 https://github.com/epezent/implot/archive/${_implot_commit}.tar.gz
 https://github.com/randy408/libspng/archive/${_libspng_commit}.tar.gz
 https://github.com/RetroAchievements/rcheevos/archive/${_rcheevos_commit}.tar.gz
 https://github.com/GPUOpen-LibrariesAndSDKs/VulkanMemoryAllocator/archive/${_vma_commit}.tar.gz
 https://github.com/KhronosGroup/SPIRV-Cross/archive/${_spirv_cross_commit}.tar.gz"
checksum="20594f6b9dbdc8f7e4f38bd9ef2bf0ebd565c42f75f86e5d3482ebf1b3cdec6f
 eb7bedc089b261c4573c2d57be4b4c172bcaa9e1fd0028a2713456f81baf14da
 f70077cd1f90d2b901dbe0cf04b035b8ee33b8941965ec25e145216f6267ebca
 dc1d6e1ac656c089f19ea1d361c3a1e41885ea4159513900f902994c27963cb9
 f678fc7b23f09303e3a8db7ed70e792d5fd21fb57c2ece1c70a65749d72f1093
 19d511a3a4ddc872c89ab62c070dd8d1fcc733e6ea4655f5876a60237cd556ba
 648b9f8e0dbacf31cf811eb561d0f6106de57b23212b08301d02ebb3aa57bd20
 e3094cf323d7b5c3a69210c2a8d97725b8ec2867aa83007b864c2c468e63b468
 f9ff12cffc6b61674cff8768f631978035fbbed6e3e85b75a5208be9d43ee9cc
 540c11d2ee64c474c10a79291af12c1c1f7e1d84ca7f6dbcda4061cfaf5f3b3b
 b2455457ff31704c4a2ad22f58387fd57b76f0c342ddf9c50af94f13e241268f"
nopie=yes

case "$XBPS_TARGET_MACHINE" in
	x86_64*|aarch64*) ;;
	*) configure_args+=" -DENABLE_GENERIC=ON" ;;
esac

post_extract() {
	mv dolphin-${_dolphin_commit}/* .
	rmdir Externals/mGBA/mgba
	rmdir Externals/cubeb/cubeb
	rmdir Externals/gtest
	rmdir Externals/zlib-ng/zlib-ng
	rmdir Externals/implot/implot
	rmdir Externals/libspng/libspng
	rmdir Externals/rcheevos/rcheevos
	rmdir Externals/VulkanMemoryAllocator
	rmdir Externals/spirv_cross/SPIRV-Cross
	mv mgba-${_mgba_commit} Externals/mGBA/mgba
	mv cubeb-${_cubeb_commit} Externals/cubeb/cubeb
	cp -r googletest-${_googletest_commit} Externals/gtest
	mv zlib-ng-${_zlib_ng_commit} Externals/zlib-ng/zlib-ng
	mv implot-${_implot_commit} Externals/implot/implot
	mv libspng-${_libspng_commit} Externals/libspng/libspng
	mv rcheevos-${_rcheevos_commit} Externals/rcheevos/rcheevos
	mv VulkanMemoryAllocator-${_vma_commit} Externals/VulkanMemoryAllocator
	mv SPIRV-Cross-${_spirv_cross_commit} Externals/spirv_cross/SPIRV-Cross
	rmdir Externals/cubeb/cubeb/googletest
	rmdir Externals/cubeb/cubeb/cmake/sanitizers-cmake
	mv googletest-${_googletest_commit} Externals/cubeb/cubeb/googletest
	mv sanitizers-cmake-${_sanitizers_cmake_commit} Externals/cubeb/cubeb/cmake/sanitizers-cmake
}

post_install() {
	rm -f ${DESTDIR}/usr/lib/*.a
}
